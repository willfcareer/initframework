<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:sec="http://www.springframework.org/schema/security"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.1.xsd">                    
    <sec:debug/>      
    <sec:http pattern="/js/**" security="none"/>
    <sec:http pattern="/resource/**" security="none"/>
    <sec:http pattern="/login.jsp" security="none"/>    
    <!-- 
    <sec:http use-expressions="true" entry-point-ref="authenticationProcessingFilterEntryPoint">
        <sec:logout/>
        <sec:remember-me />
        <sec:session-management invalid-session-url="/timeout.jsp">
            <sec:concurrency-control max-sessions="100" error-if-maximum-exceeded="true" />
        </sec:session-management>  
       	<sec:custom-filter ref="loginFilter" position="FORM_LOGIN_FILTER"  />
		<sec:custom-filter ref="securityFilter" before="FILTER_SECURITY_INTERCEPTOR"/>
    </sec:http>    
     -->
    <!-- 登录验证器 -->
    <!-- 
    <bean id="loginFilter"
		class="com.huaxin.security.MyUsernamePasswordAuthenticationFilter">
		<property name="filterProcessesUrl" value="/j_spring_security_check"></property>
		<property name="authenticationSuccessHandler" ref="loginLogAuthenticationSuccessHandler"></property>
		<property name="authenticationFailureHandler" ref="simpleUrlAuthenticationFailureHandler"></property>
		<property name="authenticationManager" ref="myAuthenticationManager"></property>		
		<property name="usersDao" ref="usersDao"></property>
	</bean>
	<bean id="loginLogAuthenticationSuccessHandler"
		class="org.springframework.security.web.authentication.SavedRequestAwareAuthenticationSuccessHandler">
		<property name="defaultTargetUrl" value="/index.jsp"></property>
	</bean>
	<bean id="simpleUrlAuthenticationFailureHandler"
		class="org.springframework.security.web.authentication.SimpleUrlAuthenticationFailureHandler">
		<property name="defaultFailureUrl" value="/login.jsp"></property>
	</bean>
     -->
	
    <!-- 认证过滤器 -->
    <bean id="securityFilter" class="com.xiaomi.ebiz.security.DefaultSecurityFilter">
    	<!-- 用户拥有的权限 -->
    	<property name="authenticationManager" ref="authenticationManager" />
    	<!-- 用户是否拥有所请求资源的权限 -->
    	<property name="accessDecisionManager" ref="accessDecisionManager" />
    	<!-- 资源与权限对应关系 -->
    	<property name="securityMetadataSource" ref="securityMetadataSource" />
    </bean>
    <!-- 实现了UserDetailsService的Bean -->
    <sec:authentication-manager alias="authenticationManager">
        <sec:authentication-provider user-service-ref="userDetailService" />
    </sec:authentication-manager>
    
    <bean id="accessDecisionManager" class="com.xiaomi.ebiz.security.DefaultAccessDecisionManager"/>
	<bean id="securityMetadataSource" class="com.xiaomi.ebiz.security.DefaultSecurityMetadataSource"/>
	<bean id="userDetailService" class="com.xiaomi.ebiz.security.DefaultUserDetailsService"/>	
	<!-- 未登录的切入点 -->
	<!-- 
	<bean id="authenticationProcessingFilterEntryPoint" class="org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint">
		<property name="loginFormUrl" value="/login.jsp"></property>
	</bean>
	 -->
</beans>
